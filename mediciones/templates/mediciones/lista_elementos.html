{% extends 'mediciones/index.html' %}

{% block title %}Maestro de Elementos{% endblock %}

{% block content %}
<div class="card">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="card-title" style="font-size: 1.25rem;">Elementos</h2>
            <div class="text-muted" style="font-size: 0.95rem;">
                Administra la base de datos de elementos (conjuntos o partes críticas).
            </div>
        </div>
        <a href="{% url 'crear_elemento' %}" class="btn btn-primary">
            <i class="ri-add-line"></i> Nuevo Elemento
        </a>
    </div>

    <table class="data-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th style="text-align: right;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for elemento in elementos %}
            <tr>
                <td style="width: 80px; font-family: monospace; color: var(--text-secondary);">#{{ elemento.id }}</td>
                <td class="fw-bold">{{ elemento.nombre }}</td>
                <td style="text-align: right; display: flex; gap: 0.5rem; justify-content: flex-end;">
                    <a href="{% url 'editar_elemento' elemento.pk %}" class="btn-soft-primary">
                        <i class="ri-edit-line"></i> Editar
                    </a>
                    <form action="{% url 'eliminar_elemento' elemento.pk %}" method="post" style="display: inline;" id="delete-form-elemento-{{ elemento.pk }}">
                        {% csrf_token %}
                        <button type="button" class="btn-soft-danger" onclick="confirmDelete('{{ elemento.nombre }}', 'delete-form-elemento-{{ elemento.pk }}')">
                            <i class="ri-delete-bin-line"></i> Borrar
                        </button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" class="empty-state">
                    <div class="empty-state-icon">
                        <i class="ri-stack-line"></i>
                    </div>
                    <div class="empty-state-title">No hay elementos definidos</div>
                    <div>Comienza registrando tu primer elemento.</div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination and Per Page Selector -->
    <div class="pagination-container">
        <div class="per-page-selector">
            <span>Registros por página:</span>
            <input type="number" class="per-page-input" value="{{ per_page }}" min="1" max="100" 
                   onchange="changePerPage(this.value)"
                   onkeydown="if(event.key==='Enter') changePerPage(this.value)">
        </div>

        <div class="pagination-controls">
            {% if elementos.has_previous %}
                <a href="?page=1&per_page={{ per_page }}" class="page-link-premium">
                    <i class="ri-double-left-line"></i>
                </a>
                <a href="?page={{ elementos.previous_page_number }}&per_page={{ per_page }}" class="page-link-premium">
                    <i class="ri-arrow-left-s-line"></i>
                </a>
            {% else %}
                <div class="page-link-premium disabled"><i class="ri-double-left-line"></i></div>
                <div class="page-link-premium disabled"><i class="ri-arrow-left-s-line"></i></div>
            {% endif %}

            <div class="page-link-premium active">
                {{ elementos.number }} de {{ elementos.paginator.num_pages }}
            </div>

            {% if elementos.has_next %}
                <a href="?page={{ elementos.next_page_number }}&per_page={{ per_page }}" class="page-link-premium">
                    <i class="ri-arrow-right-s-line"></i>
                </a>
                <a href="?page={{ elementos.paginator.num_pages }}&per_page={{ per_page }}" class="page-link-premium">
                    <i class="ri-double-right-line"></i>
                </a>
            {% else %}
                <div class="page-link-premium disabled"><i class="ri-arrow-right-s-line"></i></div>
                <div class="page-link-premium disabled"><i class="ri-double-right-line"></i></div>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function changePerPage(value) {
    if (value < 1) value = 1;
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.set('per_page', value);
    urlParams.set('page', 1);
    window.location.search = urlParams.toString();
}
function confirmDelete(name, formId) {
    Swal.fire({
        title: '¿Estás seguro?',
        text: `Vas a eliminar el elemento: "${name}". Esta acción no se puede deshacer.`,
        iconHtml: '<i class="ri-delete-bin-line" style="font-size: 3rem; color: #ef4444;"></i>',
        showCancelButton: true,
        confirmButtonText: 'Sí, eliminar',
        cancelButtonText: 'Cancelar',
        buttonsStyling: false,
        customClass: {
            popup: 'premium-swal',
            title: 'premium-title',
            htmlContainer: 'premium-text',
            actions: 'premium-actions',
            confirmButton: 'swal2-confirm premium-confirm-btn premium-confirm-btn-danger',
            cancelButton: 'swal2-cancel premium-cancel-btn',
            icon: 'premium-icon-warning-box'
        }
    }).then((result) => {
        if (result.isConfirmed) {
            document.getElementById(formId).submit();
        }
    });
}
</script>
{% endblock %}
